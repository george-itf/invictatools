{% comment %}
  ============================================================================
  INVICTA CATEGORY GRID
  ============================================================================
  Landing page section showing subcategory cards in a grid.
  
  Use on pages like "Fixings & Fasteners" to link to child collections.
  Each card is a block with image, title, and link.
  
  NO GLOW. Clean, matte, trade-professional.
  
  Trade 15.4.0 Compatible
  ============================================================================
{% endcomment %}

{%- liquid
  assign columns_desktop = section.settings.columns_desktop
  assign columns_tablet = section.settings.columns_tablet
  assign columns_mobile = section.settings.columns_mobile
-%}

<div 
  class="inv-cat-grid"
  data-section-id="{{ section.id }}"
  style="
    --inv-cat-columns: {{ columns_desktop }};
    --inv-cat-columns-tablet: {{ columns_tablet }};
    --inv-cat-columns-mobile: {{ columns_mobile }};
    --inv-cat-gap: {{ section.settings.grid_gap }}px;
    --inv-cat-card-radius: {{ section.settings.card_radius }}px;
    --inv-cat-image-ratio: {{ section.settings.image_ratio }}%;
    --inv-cat-bg: {{ section.settings.section_bg }};
    --inv-cat-card-bg: {{ section.settings.card_bg }};
    --inv-cat-card-border: {{ section.settings.card_border }};
    --inv-cat-card-hover-border: {{ section.settings.card_hover_border }};
    --inv-cat-title-color: {{ section.settings.title_color }};
    --inv-cat-heading-color: {{ section.settings.heading_color }};
  "
>
  <div class="inv-cat-grid__container page-width">
    
    {%- comment -%} Header {%- endcomment -%}
    {%- if section.settings.heading != blank or section.settings.description != blank -%}
    <div class="inv-cat-grid__header">
      {%- if section.settings.heading != blank -%}
      <h1 class="inv-cat-grid__heading">{{ section.settings.heading }}</h1>
      {%- endif -%}
      
      {%- if section.settings.description != blank -%}
      <p class="inv-cat-grid__description">{{ section.settings.description }}</p>
      {%- endif -%}
    </div>
    {%- endif -%}
    
    {%- comment -%} Grid {%- endcomment -%}
    {%- if section.blocks.size > 0 -%}
    <div class="inv-cat-grid__grid">
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when 'category' -%}
            {%- liquid
              assign card_title = block.settings.title
              assign card_link = block.settings.link
              assign card_image = block.settings.image
              assign card_collection = block.settings.collection
              
              # If collection is selected, use its data as fallback
              if card_collection != blank
                if card_title == blank
                  assign card_title = card_collection.title
                endif
                if card_link == blank
                  assign card_link = card_collection.url
                endif
                if card_image == blank
                  assign card_image = card_collection.image
                endif
              endif
            -%}
            
            <a 
              href="{{ card_link | default: '#' }}" 
              class="inv-cat-card"
              {{ block.shopify_attributes }}
            >
              {%- comment -%} Image {%- endcomment -%}
              <div class="inv-cat-card__image">
                {%- if card_image != blank -%}
                  {{ card_image | image_url: width: 800 | image_tag:
                    loading: 'lazy',
                    class: 'inv-cat-card__img',
                    widths: '300, 400, 600, 800',
                    sizes: '(min-width: 1200px) 280px, (min-width: 990px) 25vw, (min-width: 750px) 33vw, 50vw'
                  }}
                {%- else -%}
                  <div class="inv-cat-card__placeholder">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                      <circle cx="8.5" cy="8.5" r="1.5"/>
                      <polyline points="21 15 16 10 5 21"/>
                    </svg>
                  </div>
                {%- endif -%}
              </div>
              
              {%- comment -%} Title {%- endcomment -%}
              <div class="inv-cat-card__body">
                <h2 class="inv-cat-card__title">
                  {{ card_title | default: 'Category' }}
                </h2>
                
                {%- if section.settings.show_arrow -%}
                <span class="inv-cat-card__arrow" aria-hidden="true">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="5" y1="12" x2="19" y2="12"/>
                    <polyline points="12 5 19 12 12 19"/>
                  </svg>
                </span>
                {%- endif -%}
              </div>
            </a>
        {%- endcase -%}
      {%- endfor -%}
    </div>
    {%- else -%}
    
    {%- comment -%} Empty state for editor {%- endcomment -%}
    <div class="inv-cat-grid__empty">
      <p>Add category blocks to create your grid.</p>
    </div>
    {%- endif -%}
    
  </div>
</div>

<style>
  /* ============================================
     INVICTA CATEGORY GRID - STYLES
     ============================================ */
  
  .inv-cat-grid {
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
    background-color: var(--inv-cat-bg);
  }
  
  .inv-cat-grid__container {
    max-width: var(--page-width, 1200px);
    margin: 0 auto;
    padding: 0 1.5rem;
  }
  
  /* ============================================
     HEADER
     ============================================ */
  
  .inv-cat-grid__header {
    text-align: {{ section.settings.header_align }};
    margin-bottom: 32px;
  }
  
  .inv-cat-grid__heading {
    margin: 0 0 12px;
    font-size: {{ section.settings.heading_size }}px;
    font-weight: 700;
    color: var(--inv-cat-heading-color);
    text-transform: {{ section.settings.heading_transform }};
    letter-spacing: {% if section.settings.heading_transform == 'uppercase' %}0.02em{% else %}0{% endif %};
  }
  
  .inv-cat-grid__description {
    margin: 0;
    font-size: 16px;
    line-height: 1.6;
    color: #666;
    max-width: 600px;
    {% if section.settings.header_align == 'center' %}
    margin-left: auto;
    margin-right: auto;
    {% endif %}
  }
  
  /* ============================================
     GRID
     ============================================ */
  
  .inv-cat-grid__grid {
    display: grid;
    grid-template-columns: repeat(var(--inv-cat-columns), 1fr);
    gap: var(--inv-cat-gap);
  }
  
  .inv-cat-grid__empty {
    text-align: center;
    padding: 60px 20px;
    color: #666;
    background-color: #f8f8f8;
    border-radius: 12px;
    border: 2px dashed #ddd;
  }
  
  /* ============================================
     CARD
     ============================================ */
  
  .inv-cat-card {
    display: block;
    background-color: var(--inv-cat-card-bg);
    border-radius: var(--inv-cat-card-radius);
    border: 1px solid var(--inv-cat-card-border);
    overflow: hidden;
    text-decoration: none;
    transition: border-color 0.15s ease;
  }
  
  .inv-cat-card:hover {
    border-color: var(--inv-cat-card-hover-border);
  }
  
  /* Image */
  .inv-cat-card__image {
    position: relative;
    width: 100%;
    padding-bottom: var(--inv-cat-image-ratio);
    background-color: {{ section.settings.image_bg }};
    overflow: hidden;
  }
  
  .inv-cat-card__img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }
  
  .inv-cat-card:hover .inv-cat-card__img {
    transform: scale(1.03);
  }
  
  .inv-cat-card__placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ccc;
  }
  
  /* Body */
  .inv-cat-card__body {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: {{ section.settings.card_padding }}px;
  }
  
  .inv-cat-card__title {
    margin: 0;
    font-size: {{ section.settings.card_title_size }}px;
    font-weight: 600;
    color: var(--inv-cat-title-color);
    text-transform: {{ section.settings.card_title_transform }};
    letter-spacing: {% if section.settings.card_title_transform == 'uppercase' %}0.02em{% else %}0{% endif %};
    line-height: 1.3;
  }
  
  .inv-cat-card__arrow {
    flex-shrink: 0;
    color: var(--inv-cat-title-color);
    opacity: 0.4;
    transition: opacity 0.15s ease, transform 0.15s ease;
  }
  
  .inv-cat-card:hover .inv-cat-card__arrow {
    opacity: 1;
    transform: translateX(4px);
  }
  
  /* ============================================
     RESPONSIVE - TABLET
     ============================================ */
  
  @media screen and (max-width: 989px) {
    .inv-cat-grid {
      padding: {{ section.settings.padding_top | times: 0.8 | round }}px 0 {{ section.settings.padding_bottom | times: 0.8 | round }}px;
    }
    
    .inv-cat-grid__container {
      padding: 0 1rem;
    }
    
    .inv-cat-grid__heading {
      font-size: {{ section.settings.heading_size | times: 0.85 | round }}px;
    }
    
    .inv-cat-grid__grid {
      grid-template-columns: repeat(var(--inv-cat-columns-tablet), 1fr);
      gap: calc(var(--inv-cat-gap) * 0.75);
    }
  }
  
  /* ============================================
     RESPONSIVE - MOBILE
     ============================================ */
  
  @media screen and (max-width: 749px) {
    .inv-cat-grid {
      padding: {{ section.settings.padding_top | times: 0.6 | round }}px 0 {{ section.settings.padding_bottom | times: 0.6 | round }}px;
    }
    
    .inv-cat-grid__header {
      margin-bottom: 24px;
    }
    
    .inv-cat-grid__heading {
      font-size: {{ section.settings.heading_size | times: 0.7 | round }}px;
    }
    
    .inv-cat-grid__description {
      font-size: 14px;
    }
    
    .inv-cat-grid__grid {
      grid-template-columns: repeat(var(--inv-cat-columns-mobile), 1fr);
      gap: calc(var(--inv-cat-gap) * 0.5);
    }
    
    .inv-cat-card__body {
      padding: 12px;
    }
    
    .inv-cat-card__title {
      font-size: {{ section.settings.card_title_size | times: 0.85 | round }}px;
    }
  }
</style>

{% schema %}
{
  "name": "Category Grid",
  "tag": "section",
  "class": "inv-category-grid-section",
  "settings": [
    {
      "type": "header",
      "content": "Header"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Fixings & Fasteners"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Browse our full range of fixings and fasteners below."
    },
    {
      "type": "select",
      "id": "header_align",
      "label": "Header alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Centre" }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Grid Layout"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "Columns (desktop)",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 4
    },
    {
      "type": "range",
      "id": "columns_tablet",
      "label": "Columns (tablet)",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "columns_mobile",
      "label": "Columns (mobile)",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 2
    },
    {
      "type": "range",
      "id": "grid_gap",
      "label": "Gap between cards",
      "min": 12,
      "max": 32,
      "step": 4,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Card Settings"
    },
    {
      "type": "range",
      "id": "card_radius",
      "label": "Card border radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "default": 12,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "card_padding",
      "label": "Card body padding",
      "min": 12,
      "max": 24,
      "step": 2,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "image_ratio",
      "label": "Image aspect ratio (%)",
      "min": 60,
      "max": 120,
      "step": 5,
      "default": 75,
      "unit": "%",
      "info": "75% = landscape, 100% = square"
    },
    {
      "type": "checkbox",
      "id": "show_arrow",
      "label": "Show arrow on cards",
      "default": true
    },
    {
      "type": "header",
      "content": "Section Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top",
      "min": 20,
      "max": 80,
      "step": 4,
      "default": 48,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom",
      "min": 20,
      "max": 80,
      "step": 4,
      "default": 48,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Heading size",
      "min": 24,
      "max": 48,
      "step": 2,
      "default": 36,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "heading_transform",
      "label": "Heading style",
      "options": [
        { "value": "none", "label": "Normal" },
        { "value": "uppercase", "label": "Uppercase" }
      ],
      "default": "none"
    },
    {
      "type": "range",
      "id": "card_title_size",
      "label": "Card title size",
      "min": 12,
      "max": 20,
      "step": 1,
      "default": 15,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "card_title_transform",
      "label": "Card title style",
      "options": [
        { "value": "none", "label": "Normal" },
        { "value": "uppercase", "label": "Uppercase" }
      ],
      "default": "uppercase"
    },
    {
      "type": "header",
      "content": "Colours - Section"
    },
    {
      "type": "color",
      "id": "section_bg",
      "label": "Section background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading colour",
      "default": "#1a1a1a"
    },
    {
      "type": "header",
      "content": "Colours - Cards"
    },
    {
      "type": "color",
      "id": "card_bg",
      "label": "Card background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "card_border",
      "label": "Card border",
      "default": "#e5e5e5"
    },
    {
      "type": "color",
      "id": "card_hover_border",
      "label": "Card border (hover)",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "image_bg",
      "label": "Image background",
      "default": "#f8f8f8"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Card title colour",
      "default": "#1a1a1a"
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Category",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection",
          "info": "Select a collection to auto-fill title, link, and image."
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title override",
          "info": "Leave blank to use collection title."
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link override",
          "info": "Leave blank to use collection URL."
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image override",
          "info": "Leave blank to use collection image."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Category Grid",
      "blocks": [
        { "type": "category" },
        { "type": "category" },
        { "type": "category" },
        { "type": "category" }
      ]
    }
  ]
}
{% endschema %}