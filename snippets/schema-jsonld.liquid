{%- comment -%}
  Schema.org JSON-LD structured data — Invicta Tools
  Renders sitewide Organization + page-specific Product, BreadcrumbList, LocalBusiness
{%- endcomment -%}

{%- comment -%} ===== ORGANIZATION SCHEMA (sitewide) ===== {%- endcomment -%}
{%- liquid
  assign org_name = settings.seo_org_name | default: shop.name
-%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": {{ org_name | json }},
  "url": {{ shop.url | json }}
  {%- if settings.logo -%}
    ,"logo": {{ settings.logo | image_url: width: 600 | prepend: 'https:' | json }}
  {%- endif -%}
  {%- if settings.seo_org_telephone != blank -%}
    ,"telephone": {{ settings.seo_org_telephone | json }}
  {%- endif -%}
  {%- liquid
    assign social_links = ''
    if settings.social_facebook_link != blank
      assign social_links = social_links | append: settings.social_facebook_link | append: '|||'
    endif
    if settings.social_instagram_link != blank
      assign social_links = social_links | append: settings.social_instagram_link | append: '|||'
    endif
    if settings.social_youtube_link != blank
      assign social_links = social_links | append: settings.social_youtube_link | append: '|||'
    endif
    if settings.social_tiktok_link != blank
      assign social_links = social_links | append: settings.social_tiktok_link | append: '|||'
    endif
    if settings.social_twitter_link != blank
      assign social_links = social_links | append: settings.social_twitter_link | append: '|||'
    endif
    if settings.social_pinterest_link != blank
      assign social_links = social_links | append: settings.social_pinterest_link | append: '|||'
    endif
    assign social_array = social_links | split: '|||'
  -%}
  {%- if social_array.size > 0 -%}
    ,"sameAs": [
      {%- for link in social_array -%}
        {%- unless link == blank -%}
          {{ link | json }}{%- unless forloop.last %},{% endunless -%}
        {%- endunless -%}
      {%- endfor -%}
    ]
  {%- endif -%}
}
</script>

{%- comment -%} ===== LOCAL BUSINESS SCHEMA (only if address configured) ===== {%- endcomment -%}
{%- if settings.seo_local_street != blank and settings.seo_local_city != blank and settings.seo_local_postcode != blank -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "HardwareStore",
  "name": {{ org_name | json }},
  "url": {{ shop.url | json }}
  {%- if settings.logo -%}
    ,"image": {{ settings.logo | image_url: width: 600 | prepend: 'https:' | json }}
  {%- endif -%}
  {%- if settings.seo_org_telephone != blank -%}
    ,"telephone": {{ settings.seo_org_telephone | json }}
  {%- endif -%}
  ,"address": {
    "@type": "PostalAddress",
    "streetAddress": {{ settings.seo_local_street | json }},
    "addressLocality": {{ settings.seo_local_city | json }}
    {%- if settings.seo_local_region != blank -%}
      ,"addressRegion": {{ settings.seo_local_region | json }}
    {%- endif -%}
    ,"postalCode": {{ settings.seo_local_postcode | json }},
    "addressCountry": "GB"
  }
  {%- if settings.seo_local_hours != blank -%}
    ,"openingHours": {{ settings.seo_local_hours | json }}
  {%- endif -%}
  ,"priceRange": "££"
}
</script>
{%- endif -%}

{%- comment -%} ===== PRODUCT SCHEMA (product pages only) ===== {%- endcomment -%}
{%- if request.page_type == 'product' -%}
{%- liquid
  assign current_variant = product.selected_or_first_available_variant
  assign product_image = product.featured_image | image_url: width: 1200 | prepend: 'https:'
  assign product_desc = product.description | strip_html | truncate: 5000 | escape
-%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": {{ product.title | json }},
  "description": {{ product_desc | json }},
  "url": {{ shop.url | append: product.url | json }}
  {%- if product.featured_image -%}
    ,"image": {{ product_image | json }}
  {%- endif -%}
  {%- if current_variant.sku != blank -%}
    ,"sku": {{ current_variant.sku | json }}
  {%- endif -%}
  {%- if current_variant.barcode != blank -%}
    ,"mpn": {{ current_variant.barcode | json }}
  {%- elsif current_variant.sku != blank -%}
    ,"mpn": {{ current_variant.sku | json }}
  {%- endif -%}
  {%- if product.vendor != blank -%}
    ,"brand": {
      "@type": "Brand",
      "name": {{ product.vendor | json }}
    }
  {%- endif -%}
  ,"offers": {
    "@type": "Offer",
    "url": {{ shop.url | append: product.url | json }},
    "priceCurrency": "GBP",
    "price": {{ current_variant.price | money_without_currency | remove: ',' | json }},
    "priceValidUntil": "{{ 'now' | date: '%Y' | plus: 1 }}-12-31",
    "itemCondition": "https://schema.org/NewCondition"
    {%- if current_variant.available -%}
      ,"availability": "https://schema.org/InStock"
    {%- else -%}
      ,"availability": "https://schema.org/OutOfStock"
    {%- endif -%}
  }
}
</script>
{%- endif -%}

{%- comment -%} ===== BREADCRUMBLIST SCHEMA ===== {%- endcomment -%}
{%- if request.page_type == 'product' -%}
  {%- liquid
    assign bc_collection = nil
    assign current_path = request.path
    for col in product.collections
      assign col_path = col.url
      if current_path contains col_path
        assign bc_collection = col
        break
      endif
    endfor
    if bc_collection == nil
      assign bc_collection = product.collections | first
    endif
  -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": {{ shop.url | json }}
      }
      {%- if bc_collection -%}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ bc_collection.title | json }},
        "item": {{ shop.url | append: bc_collection.url | json }}
      }
      ,{
        "@type": "ListItem",
        "position": 3,
        "name": {{ product.title | json }}
      }
      {%- else -%}
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ product.title | json }}
      }
      {%- endif -%}
    ]
  }
  </script>
{%- elsif request.page_type == 'collection' -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": {{ shop.url | json }}
      }
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ collection.title | json }}
      }
    ]
  }
  </script>
{%- elsif request.page_type == 'article' -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": {{ shop.url | json }}
      }
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ blog.title | json }},
        "item": {{ shop.url | append: blog.url | json }}
      }
      ,{
        "@type": "ListItem",
        "position": 3,
        "name": {{ article.title | json }}
      }
    ]
  }
  </script>
{%- elsif request.page_type == 'blog' -%}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": {{ shop.url | json }}
      }
      ,{
        "@type": "ListItem",
        "position": 2,
        "name": {{ blog.title | json }}
      }
    ]
  }
  </script>
{%- endif -%}
