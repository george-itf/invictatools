{%- liquid
  assign og_title = page_title | default: shop.name
  assign og_url = canonical_url | default: request.origin
  assign og_type = 'website'
  assign og_description = page_description | default: shop.description | default: shop.name

  if request.page_type == 'product'
    assign og_type = 'product'
  elsif request.page_type == 'article'
    assign og_type = 'article'
  elsif request.page_type == 'password'
    assign og_url = request.origin
  endif

  comment
    NOINDEX SUPPORT FOR ADS LANDING PAGES
    Pages using these templates will not be indexed by search engines
    Perfect for Google Ads landing pages that shouldn't appear in organic search
  endcomment
  assign noindex_templates = 'page.trade-landing,page.thank-you-trade' | split: ','
  assign current_template = template.name | append: '.' | append: template.suffix
  assign should_noindex = false
  for noindex_template in noindex_templates
    if current_template == noindex_template
      assign should_noindex = true
      break
    endif
  endfor
%}

{%- if should_noindex -%}
  <meta name="robots" content="noindex, nofollow">
{%- else -%}
  {%- liquid
    comment
      SEO: Meta robots for filtered/paginated collections and search results
      Controlled via theme settings under "SEO & Crawl Control"
    endcomment
    assign seo_noindex = false

    if request.page_type == 'collection' and settings.seo_noindex_filtered_collections
      for filter in collection.filters
        if filter.active_values.size > 0 or filter.min_value.value or filter.max_value.value
          assign seo_noindex = true
          break
        endif
      endfor
      unless seo_noindex
        if collection.sort_by != collection.default_sort_by and collection.sort_by != blank
          assign seo_noindex = true
        endif
      endunless
    endif

    if request.page_type == 'collection' and settings.seo_noindex_paginated_collections
      assign noindex_from = settings.seo_paginated_noindex_from_page | default: 2
      if current_page >= noindex_from
        assign seo_noindex = true
      endif
    endif

    if request.page_type == 'search' and settings.seo_noindex_search_results
      assign seo_noindex = true
    endif
  -%}
  {%- if seo_noindex -%}
    <meta name="robots" content="noindex, follow">
  {%- endif -%}
{%- endif -%}

<meta property="og:site_name" content="{{ shop.name }}">
<meta property="og:url" content="{{ og_url }}">
<meta property="og:title" content="{{ og_title | escape }}">
<meta property="og:type" content="{{ og_type }}">
<meta property="og:description" content="{{ og_description | escape }}">

{%- if page_image -%}
  <meta property="og:image" content="https:{{ page_image | image_url }}">
  <meta property="og:image:secure_url" content="https:{{ page_image | image_url }}">
  <meta property="og:image:width" content="{{ page_image.width }}">
  <meta property="og:image:height" content="{{ page_image.height }}">
{%- endif -%}

{%- if request.page_type == 'product' -%}
  <meta property="og:price:amount" content="{{ product.price | money_without_currency | strip_html }}">
  <meta property="og:price:currency" content="{{ cart.currency.iso_code }}">
{%- endif -%}

{%- if settings.social_twitter_link != blank -%}
  <meta name="twitter:site" content="{{ settings.social_twitter_link | split: 'twitter.com/' | last | prepend: '@' }}">
{%- endif -%}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ og_title | escape }}">
<meta name="twitter:description" content="{{ og_description | escape }}">
