{%- comment -%}
  ============================================
  PWA Head Tags — Invicta Tools
  ============================================
  Progressive Web App meta tags, manifest link,
  Apple touch icons, and service worker registration.
  
  Installation:
  1. Add this file to snippets/pwa-head.liquid
  2. In layout/theme.liquid, add inside <head>:
     {%- render 'pwa-head' -%}
  
  @version 1.0.0
  ============================================
{%- endcomment -%}

{%- comment -%} Web App Manifest {%- endcomment -%}
<link rel="manifest" href="{{ 'manifest.webmanifest' | asset_url }}" crossorigin="use-credentials">

{%- comment -%} Theme colour for browser UI {%- endcomment -%}
<meta name="theme-color" content="#e11d26">
<meta name="theme-color" content="#e11d26" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#1a1a1a" media="(prefers-color-scheme: dark)">

{%- comment -%} Apple Web App Configuration {%- endcomment -%}
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Invicta Tools">

{%- comment -%} Apple Touch Icons {%- endcomment -%}
<link rel="apple-touch-icon" href="https://cdn.shopify.com/s/files/1/{{ shop.id | split: '/' | last }}/files/pwa-icon-180.png">
<link rel="apple-touch-icon" sizes="152x152" href="https://cdn.shopify.com/s/files/1/{{ shop.id | split: '/' | last }}/files/pwa-icon-152.png">
<link rel="apple-touch-icon" sizes="167x167" href="https://cdn.shopify.com/s/files/1/{{ shop.id | split: '/' | last }}/files/pwa-icon-167.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://cdn.shopify.com/s/files/1/{{ shop.id | split: '/' | last }}/files/pwa-icon-180.png">

{%- comment -%} Apple Splash Screens {%- endcomment -%}
{%- comment -%} iPhone SE, 8, 7, 6s {%- endcomment -%}
<link rel="apple-touch-startup-image" 
      href="https://cdn.shopify.com/s/files/1/{{ shop.id | split: '/' | last }}/files/splash-750x1334.png"
      media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)">

{%- comment -%} iPhone 13/14, 12 Pro {%- endcomment -%}
<link rel="apple-touch-startup-image" 
      href="https://cdn.shopify.com/s/files/1/{{ shop.id | split: '/' | last }}/files/splash-1170x2532.png"
      media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)">

{%- comment -%} iPhone 14 Pro {%- endcomment -%}
<link rel="apple-touch-startup-image" 
      href="https://cdn.shopify.com/s/files/1/{{ shop.id | split: '/' | last }}/files/splash-1179x2556.png"
      media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)">

{%- comment -%} iPhone 14 Pro Max {%- endcomment -%}
<link rel="apple-touch-startup-image" 
      href="https://cdn.shopify.com/s/files/1/{{ shop.id | split: '/' | last }}/files/splash-1290x2796.png"
      media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)">

{%- comment -%} iPad Pro 12.9" {%- endcomment -%}
<link rel="apple-touch-startup-image" 
      href="https://cdn.shopify.com/s/files/1/{{ shop.id | split: '/' | last }}/files/splash-2048x2732.png"
      media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)">

{%- comment -%} Windows Tile Configuration {%- endcomment -%}
<meta name="msapplication-TileColor" content="#e11d26">
<meta name="msapplication-TileImage" content="https://cdn.shopify.com/s/files/1/{{ shop.id | split: '/' | last }}/files/pwa-icon-144.png">
<meta name="msapplication-config" content="none">

{%- comment -%} Prevent auto-detection of phone numbers {%- endcomment -%}
<meta name="format-detection" content="telephone=no">

{%- comment -%} Service Worker Registration — deferred to avoid blocking render {%- endcomment -%}
<script>
  if ('serviceWorker' in navigator) {
    // Use requestIdleCallback where available, fallback to load event
    var registerSW = function() {
      navigator.serviceWorker.register('{{ "service-worker.js" | asset_url }}', { scope: '/' })
        .then(function(reg) {
          var KEY = 'invicta-sw-last-update', INTERVAL = 43200000; // 12h
          try {
            var last = localStorage.getItem(KEY);
            if (!last || (Date.now() - parseInt(last, 10)) > INTERVAL) {
              reg.update();
              localStorage.setItem(KEY, Date.now().toString());
            }
          } catch(e) {}
        }).catch(function() {});
    };
    if ('requestIdleCallback' in window) {
      requestIdleCallback(registerSW);
    } else {
      window.addEventListener('load', registerSW);
    }
  }
</script>
